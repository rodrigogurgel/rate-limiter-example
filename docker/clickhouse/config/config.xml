<?xml version="1.0"?>
<clickhouse>
    <!-- HTTP claro e bind em todas as interfaces -->
    <http_port>8123</http_port>
    <listen_host>0.0.0.0</listen_host>
    <listen_host>::</listen_host>

    <!-- Settings devem ficar em profiles -->
    <profiles>
        <default>
            <!-- seu limite de memória de consulta -->
            <max_memory_usage>6000000000</max_memory_usage>
            <max_bytes_before_external_group_by>4000000000</max_bytes_before_external_group_by>
            <max_bytes_before_external_sort>4000000000</max_bytes_before_external_sort>
            <!-- para usar ENGINE=TimeSeries -->
            <allow_experimental_time_series_table>1</allow_experimental_time_series_table>
        </default>
    </profiles>

    <!-- Endpoints Prometheus nativos (porta separada) -->
    <prometheus>
        <port>9363</port>
        <handlers>
            <!-- métricas do próprio CH -->
            <metrics>
                <url>/metrics</url>
                <handler>
                    <type>expose_metrics</type>
                    <metrics>true</metrics>
                    <asynchronous_metrics>true</asynchronous_metrics>
                    <events>true</events>
                    <errors>true</errors>
                </handler>
            </metrics>

            <!-- remote-write: precisa que metrics.prom_rw exista -->
            <rw>
                <url>/write</url>
                <handler>
                    <type>remote_write</type>
                    <database>metrics</database>
                    <table>prom_rw</table>
                </handler>
            </rw>

            <!-- remote-read (opcional) -->
            <rr>
                <url>/read</url>
                <handler>
                    <type>remote_read</type>
                    <database>metrics</database>
                    <table>prom_rw</table>
                </handler>
            </rr>
        </handlers>
    </prometheus>
</clickhouse>
